<!-- Header Navigation Component - Hamburger Only on Mobile -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary" id="mainNavbar">
    <div class="container-fluid">
        <!-- Brand -->
        <a class="navbar-brand d-flex align-items-center" href="../index.html">
            <img src="../assets/images/logo.png" alt="Vervo" height="30" class="me-2">
            <span>Aslan Group Portal</span>
        </a>
        
        <!-- Mobile Toggle Button - Only visible on mobile -->
        <button class="navbar-toggler d-lg-none" type="button" id="sidebarToggle"
                aria-controls="mobileSidebar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Desktop Navigation - Visible on large screens -->
        <div class="collapse navbar-collapse d-none d-lg-flex" id="navbarNav">
            <!-- Main Navigation -->
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="dashboard.html" id="navDashboard">
                        <i class="fas fa-home me-2"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="aractakip.html" id="navAracTakip">
                        <i class="fas fa-car me-2"></i>Araç Takip
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="navReports">
                        <i class="fas fa-chart-bar me-2"></i>Raporlar
                    </a>
                </li>
            </ul>
            
            <!-- Desktop User Menu -->
            <ul class="navbar-nav ms-auto">
                <!-- Notifications -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle position-relative" href="#" id="notificationDropdown" 
                       role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-bell"></i>
                        <span class="badge bg-danger position-absolute top-0 start-100 translate-middle rounded-pill d-none" 
                              id="notificationBadge">0</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown">
                        <li><h6 class="dropdown-header">Bildirimler</h6></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">
                            <small class="text-muted">Henüz bildirim yok</small>
                        </a></li>
                    </ul>
                </li>
                
                <!-- User Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" 
                       role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="user-avatar bg-light text-primary me-2 rounded-circle d-flex align-items-center justify-content-center">
                            <span class="fw-bold">U</span>
                        </div>
                        <span class="d-none d-md-inline">Kullanıcı</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><h6 class="dropdown-header">
                            <span id="userDisplayName">Kullanıcı</span><br>
                            <small class="text-muted" id="userEmail">user@example.com</small>
                        </h6></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">
                            <i class="fas fa-user me-2"></i>Profil
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <i class="fas fa-cog me-2"></i>Ayarlar
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Çıkış Yap
                        </a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Mobile Sidebar Overlay - Only for mobile -->
<div class="mobile-sidebar-overlay d-lg-none" id="sidebarOverlay"></div>

<!-- Mobile Sidebar - Only for mobile -->
<div class="mobile-sidebar d-lg-none" id="mobileSidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
        <div class="d-flex align-items-center">
            <img src="../assets/images/logo.png" alt="Vervo" height="30" class="me-2">
            <h5 class="mb-0 text-white">Aslan Group Portal</h5>
        </div>
        <button class="sidebar-close" id="sidebarClose">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- User Info -->
    <div class="sidebar-user">
        <div class="d-flex align-items-center">
            <div class="user-avatar bg-light text-primary me-3 rounded-circle d-flex align-items-center justify-content-center">
                <span class="fw-bold">U</span>
            </div>
            <div>
                <h6 class="mb-0 text-white" id="mobileUserName">Kullanıcı</h6>
                <small class="text-white-50" id="mobileUserEmail">user@example.com</small>
            </div>
        </div>
    </div>
    
    <!-- Navigation Menu -->
    <div class="sidebar-menu">
        <!-- Main Navigation -->
        <div class="menu-section">
            <h6 class="menu-title">ANA MENÜ</h6>
            <ul class="menu-list">
                <li class="menu-item">
                    <a href="dashboard.html" class="menu-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="aractakip.html" class="menu-link">
                        <i class="fas fa-car"></i>
                        <span>Araç Takip Sistemi</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Raporlar</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- User Menu -->
        <div class="menu-section">
            <h6 class="menu-title">HESAP</h6>
            <ul class="menu-list">
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-bell"></i>
                        <span>Bildirimler</span>
                        <span class="badge bg-danger ms-auto d-none" id="mobileBadge">0</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-user"></i>
                        <span>Profil</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-cog"></i>
                        <span>Ayarlar</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
        <button class="btn btn-outline-light w-100" onclick="logout()">
            <i class="fas fa-sign-out-alt me-2"></i>
            Çıkış Yap
        </button>
    </div>
</div>

<!-- FontAwesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Navigation Styles -->
<style>
/* Base navbar styles */
.navbar {
    min-height: 56px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: relative;
    z-index: 1040;
}

.navbar .container-fluid {
    padding: 0 1rem;
}

/* Brand styling */
.navbar-brand {
    font-weight: 700;
    font-size: 1.25rem;
    color: white !important;
    text-decoration: none;
}

.navbar-brand:hover {
    color: rgba(255, 255, 255, 0.9) !important;
}

.navbar-brand img {
    height: 30px;
    width: auto;
    filter: brightness(0) invert(1);
}

/* Mobile toggle button - Only visible on mobile (< lg) */
.navbar-toggler {
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    border-radius: 6px !important;
    padding: 6px 10px !important;
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px);
    transition: all 0.2s ease;
}

.navbar-toggler:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
}

.navbar-toggler:focus {
    box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25) !important;
    outline: none !important;
}

.navbar-toggler-icon {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2.5' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
    width: 1.2em !important;
    height: 1.2em !important;
}

/* Desktop navigation - Only visible on lg+ screens */
.navbar-nav .nav-link {
    color: rgba(255, 255, 255, 0.9) !important;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    transition: all 0.2s ease;
    margin: 0 0.2rem;
}

.navbar-nav .nav-link:hover,
.navbar-nav .nav-link.active {
    color: white !important;
    background-color: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px);
}

/* Dropdown styles */
.dropdown-menu {
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    margin-top: 0.5rem;
    min-width: 200px;
}

.dropdown-item {
    padding: 0.5rem 1rem;
    transition: background-color 0.2s ease;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

/* User avatar */
.user-avatar {
    width: 32px;
    height: 32px;
    font-size: 0.9rem;
}

/* Notification badge */
.badge {
    font-size: 0.7rem;
    min-width: 1.2em;
    height: 1.2em;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Mobile sidebar overlay */
.mobile-sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1050;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.mobile-sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
}

/* Mobile sidebar */
.mobile-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 300px;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    z-index: 1060;
    display: flex;
    flex-direction: column;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
}

.mobile-sidebar.show {
    transform: translateX(0);
}

/* Sidebar header */
.sidebar-header {
    padding: 1.25rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.sidebar-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.25rem;
    transition: all 0.2s ease;
}

.sidebar-close:hover {
    transform: rotate(90deg);
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
}

/* Sidebar user info */
.sidebar-user {
    padding: 1.25rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* Sidebar menu */
.sidebar-menu {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
}

.menu-section {
    margin-bottom: 2rem;
}

.menu-title {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 0.75rem;
    padding: 0 1.25rem;
}

.menu-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.menu-item {
    margin-bottom: 0.25rem;
}

.menu-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: all 0.2s ease;
    position: relative;
    font-weight: 500;
}

.menu-link:hover,
.menu-link.active {
    color: white;
    background: rgba(255, 255, 255, 0.1);
    text-decoration: none;
    transform: translateX(5px);
}

.menu-link i {
    width: 20px;
    text-align: center;
    margin-right: 0.875rem;
    font-size: 1rem;
}

.menu-link .badge {
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
}

/* Sidebar footer */
.sidebar-footer {
    padding: 1.25rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: auto;
}

/* Prevent body scroll when sidebar is open */
body.sidebar-open {
    overflow: hidden;
}

/* Responsive adjustments */
@media (max-width: 575.98px) {
    .navbar .container-fluid {
        padding: 0 0.75rem;
    }
    
    .navbar-brand {
        font-size: 1rem;
    }
    
    .navbar-brand img {
        height: 22px;
    }
    
    .mobile-sidebar {
        width: 280px;
    }
}

/* Large screens - Hide mobile elements */
@media (min-width: 992px) {
    .mobile-sidebar,
    .mobile-sidebar-overlay {
        display: none !important;
    }
}

/* Animation states */
.mobile-sidebar,
.mobile-sidebar-overlay {
    will-change: transform, opacity;
}

/* Active state for current page */
.menu-link.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: white;
}

/* Accessibility improvements */
.sidebar-close:focus,
.menu-link:focus,
.nav-link:focus,
.dropdown-toggle:focus {
    outline: 2px solid rgba(255, 255, 255, 0.5);
    outline-offset: 2px;
}

/* Animation for dropdowns */
.dropdown-menu {
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    pointer-events: none;
}

.dropdown-menu.show {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}
</style>

<!-- Navigation Script -->
<script>
// Namespace to prevent conflicts
window.NavigationModule = window.NavigationModule || {};

// Immediate function definition - before DOM load
(function() {
    'use strict';
    
    console.log('🌍 NavigationModule initializing...');
    
    // Safe toggle sidebar function
    window.NavigationModule.toggleSidebar = function() {
        console.log('🔄 NavigationModule.toggleSidebar called');
        const sidebar = document.getElementById('mobileSidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        if (!sidebar || !overlay) {
            console.error('❌ Sidebar elements not found');
            return false;
        }
        
        const isOpen = sidebar.classList.contains('show');
        
        if (isOpen) {
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
            document.body.classList.remove('sidebar-open');
            console.log('✅ Sidebar closed');
        } else {
            sidebar.classList.add('show');
            overlay.classList.add('show');
            document.body.classList.add('sidebar-open');
            console.log('✅ Sidebar opened');
        }
        
        return true;
    };

    // Safe close sidebar function
    window.NavigationModule.closeSidebar = function() {
        console.log('🔒 NavigationModule.closeSidebar called');
        const sidebar = document.getElementById('mobileSidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        if (sidebar && overlay) {
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
            document.body.classList.remove('sidebar-open');
            console.log('✅ Sidebar closed');
            return true;
        }
        return false;
    };

    // Global wrapper functions for backward compatibility
    window.toggleSidebar = function() {
        return window.NavigationModule.toggleSidebar();
    };

    window.closeSidebar = function() {
        return window.NavigationModule.closeSidebar();
    };
    
    // Immediate event listener attachment with enhanced debugging
    function attachToggleListener() {
        console.log('🔍 Attempting to attach toggle listener...');
        const sidebarToggle = document.getElementById('sidebarToggle');
        
        if (sidebarToggle) {
            console.log('🎯 Found toggle button, attaching listener');
            
            // Remove any existing listeners first
            const newButton = sidebarToggle.cloneNode(true);
            sidebarToggle.parentNode.replaceChild(newButton, sidebarToggle);
            
            newButton.addEventListener('click', function(e) {
                console.log('🖱️ CLICK EVENT FIRED!');
                e.preventDefault();
                e.stopPropagation();
                
                // Debug sidebar elements
                const sidebar = document.getElementById('mobileSidebar');
                const overlay = document.getElementById('sidebarOverlay');
                
                console.log('Sidebar found:', !!sidebar);
                console.log('Overlay found:', !!overlay);
                
                if (sidebar && overlay) {
                    console.log('📱 Opening sidebar...');
                    sidebar.classList.add('show');
                    overlay.classList.add('show');
                    document.body.classList.add('sidebar-open');
                    console.log('✅ Sidebar should be open now');
                } else {
                    console.error('❌ Sidebar elements missing');
                }
            });
            
            console.log('✅ Click listener attached successfully');
            return true;
        } else {
            console.log('❌ Toggle button not found');
            return false;
        }
    }
    
    // Try to attach immediately and keep trying
    let attached = false;
    
    if (document.readyState !== 'loading') {
        console.log('📄 DOM already loaded, trying to attach...');
        attached = attachToggleListener();
    }
    
    // Also try when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('📄 DOM Content Loaded event fired');
        if (!attached) {
            attached = attachToggleListener();
        }
    });
    
    // Fallback: keep trying for up to 5 seconds
    let attempts = 0;
    const maxAttempts = 50;
    const tryAttach = setInterval(() => {
        attempts++;
        console.log(`🔄 Attachment attempt ${attempts}/${maxAttempts}`);
        
        if (!attached) {
            attached = attachToggleListener();
        }
        
        if (attached || attempts >= maxAttempts) {
            clearInterval(tryAttach);
            if (attached) {
                console.log('🎉 Toggle listener successfully attached!');
            } else {
                console.warn('⚠️ Could not attach toggle listener after max attempts');
                // Last resort: try to find button and log state
                const btn = document.getElementById('sidebarToggle');
                console.log('Button exists:', !!btn);
                if (btn) {
                    console.log('Button HTML:', btn.outerHTML);
                }
            }
        }
    }, 100);
    
    console.log('✅ NavigationModule ready');
})();

// Initialize navigation functionality - Protected execution
(function() {
    'use strict';
    
    let initialized = false;
    
    function safeInitialize() {
        if (initialized) {
            console.log('⚠️ Navigation already initialized, skipping...');
            return;
        }
        
        console.log('🚀 Initializing navigation...');
        
        try {
            // Initialize dropdowns (desktop)
            initializeDropdowns();
            
            // Set active navigation based on current page
            setActiveNavigation();
            
            // Update user information
            updateUserInfo();
            
            // Initialize notification system
            initializeNotifications();
            
            // Initialize mobile sidebar events
            initializeMobileSidebar();
            
            initialized = true;
            console.log('✅ Navigation initialized successfully');
            
        } catch (error) {
            console.error('❌ Navigation initialization error:', error);
        }
    }
    
    // Multiple initialization attempts
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', safeInitialize);
    } else {
        safeInitialize();
    }
    
    // Fallback initialization
    setTimeout(safeInitialize, 100);
    
})();

function initializeMobileSidebar() {
    console.log('📱 Initializing mobile sidebar...');
    
    // Close button
    const sidebarClose = document.getElementById('sidebarClose');
    if (sidebarClose) {
        sidebarClose.addEventListener('click', function(e) {
            e.preventDefault();
            window.NavigationModule.closeSidebar();
        });
        console.log('✅ Close button listener added');
    }
    
    // Overlay click
    const overlay = document.getElementById('sidebarOverlay');
    if (overlay) {
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                window.NavigationModule.closeSidebar();
            }
        });
        console.log('✅ Overlay listener added');
    }
    
    // Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.NavigationModule.closeSidebar();
        }
    });
    
    // Auto-close on window resize to desktop
    window.addEventListener('resize', function() {
        if (window.innerWidth >= 992) {
            window.NavigationModule.closeSidebar();
        }
    });
    
    // Menu links - close sidebar when navigating
    const menuLinks = document.querySelectorAll('.mobile-sidebar .menu-link');
    menuLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (this.href && !this.href.includes('#')) {
                setTimeout(() => {
                    window.NavigationModule.closeSidebar();
                }, 100);
            }
        });
    });
    
    console.log('✅ Mobile sidebar initialized');
}

function initializeDropdowns() {
    // Handle dropdown toggles (desktop only)
    document.querySelectorAll('.dropdown-toggle').forEach(function(toggle) {
        toggle.addEventListener('click', function(e) {
            e.preventDefault();
            
            const menu = this.nextElementSibling;
            const isVisible = menu.classList.contains('show');
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu.show').forEach(otherMenu => {
                if (otherMenu !== menu) {
                    otherMenu.classList.remove('show');
                    const otherToggle = otherMenu.previousElementSibling;
                    if (otherToggle) {
                        otherToggle.setAttribute('aria-expanded', 'false');
                    }
                }
            });
            
            // Toggle current dropdown
            menu.classList.toggle('show', !isVisible);
            this.setAttribute('aria-expanded', (!isVisible).toString());
        });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown')) {
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
            });
            document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
                toggle.setAttribute('aria-expanded', 'false');
            });
        }
    });
}

function setActiveNavigation() {
    const currentPage = window.location.pathname.split('/').pop();
    
    // Desktop navigation
    const desktopNavLinks = document.querySelectorAll('.navbar-nav .nav-link:not(.dropdown-toggle)');
    desktopNavLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && (href === currentPage || href.includes(currentPage))) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
    
    // Mobile sidebar navigation
    const mobileMenuLinks = document.querySelectorAll('.menu-link');
    mobileMenuLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && (href === currentPage || href.includes(currentPage))) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
}

function updateUserInfo() {
    const userInfo = getUserFromStorage();
    if (userInfo) {
        // Desktop user info
        const userDisplayName = document.getElementById('userDisplayName');
        const userEmail = document.getElementById('userEmail');
        const userAvatar = document.querySelector('.navbar .user-avatar span');
        
        if (userDisplayName) {
            userDisplayName.textContent = userInfo.name || 'Kullanıcı';
        }
        
        if (userEmail) {
            userEmail.textContent = userInfo.email || 'user@example.com';
        }
        
        if (userAvatar && userInfo.name) {
            userAvatar.textContent = userInfo.name.charAt(0).toUpperCase();
        }
        
        // Mobile user info
        const mobileUserName = document.getElementById('mobileUserName');
        const mobileUserEmail = document.getElementById('mobileUserEmail');
        const mobileUserAvatar = document.querySelector('.sidebar-user .user-avatar span');
        
        if (mobileUserName && userInfo.name) {
            mobileUserName.textContent = userInfo.name;
        }
        
        if (mobileUserEmail && userInfo.email) {
            mobileUserEmail.textContent = userInfo.email;
        }
        
        if (mobileUserAvatar && userInfo.name) {
            mobileUserAvatar.textContent = userInfo.name.charAt(0).toUpperCase();
        }
    }
}

function initializeNotifications() {
    // Simulate notification count
    const notificationBadge = document.getElementById('notificationBadge');
    const mobileBadge = document.getElementById('mobileBadge');
    
    // You can update this with real notification count from API
    const notificationCount = 0;
    
    if (notificationCount > 0) {
        if (notificationBadge) {
            notificationBadge.textContent = notificationCount;
            notificationBadge.classList.remove('d-none');
        }
        if (mobileBadge) {
            mobileBadge.textContent = notificationCount;
            mobileBadge.classList.remove('d-none');
        }
    } else {
        if (notificationBadge) notificationBadge.classList.add('d-none');
        if (mobileBadge) mobileBadge.classList.add('d-none');
    }
}

function getUserFromStorage() {
    try {
        const userData = localStorage.getItem('userData');
        return userData ? JSON.parse(userData) : null;
    } catch (e) {
        console.error('Error getting user data from storage:', e);
        return null;
    }
}

function logout() {
    // Clear user session
    localStorage.removeItem('token');
    localStorage.removeItem('userData');
    
    // Show loading state
    const logoutBtn = event.target.closest('a, button');
    if (logoutBtn) {
        logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Çıkış yapılıyor...';
    }
    
    // Redirect to login page
    setTimeout(() => {
        window.location.href = '../login.html';
    }, 500);
}

// Global functions for external use
window.updateUserInfo = updateUserInfo;
window.logout = logout;
</script>